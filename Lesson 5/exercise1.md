# Задание №1. MPA, SPA, PWA

__SPA приложения__

Single page application (SPA, одностраничные веб-приложения) реализуют сложный функционал в рамках одного окна браузера без перезагрузки. Динамическое обновление содержимого страницы достигается технологией AJAX (Asynchronous JavaScript and XML, асинхронный JavaScript и XML). В ответ на действия пользователя (прокрутка страницы, нажатие кнопок, заполнение формы, движение ползунка и т.п.) содержание страницы будет меняться.

Неопытный пользователь может даже посчитать, что столкнулся с десктопным приложением, так как все изменения происходят практически моментально. К слову, многие мобильные приложения используют такой подход.

В сочетании с фреймворками JavaScript (Angular, React, Vue) работа таких программ становится максимально плавной. Обычный сайт, в отличие от SPA, не может взаимодействовать с пользователями(Максимум - можно оставить комментарий).

<strong> Примеры:</strong>

1. [МейлРУ почта](https://mail.ru);

2. [Сбербанк. Онлайн](https://online.sberbank.ru/CSAFront/index.do);

3. [ГосУслуги](https://gosuslugi.ru).

__MPA приложения__

Multi Page Application (MPA, многостраничные web-приложения) применяются для построения сложных систем. В данном случае любые изменения в данных приводят к полной перезагрузке страницы. Хороши для подачи большого количества информации и возможности широкого функционала в пределах веб-приложения.

Несмотря на то, что они требуют больших объемов ресурсов для реализации и существенно дороже, другие виды web-приложений их заменить не могут. Однако тенденции показывают, что общая доля MPA постепенно снижается.

<strong> Примеры:</strong>

1. [Amazon](https://www.amazon.com);

2. [Citilink](https://www.citilink.ru/?/);

3. [МВидео](https://www.mvideo.ru).


__PWA приложения__

Progressive Web Application (PWA, прогрессивные web-приложения) – новый способ «подачи» web-сервисов, который максимально сближает их с обычным, привычным десктопным приложением, но на качественно более высоком уровне.

Представим ситуацию: человек посещает некоторый сайт, который предлагает ему установить его на другие устройства. Теперь и на ПК, и в телефоне вы сможете получать push-уведомления, работать оффлайн, в фоновом режиме независимо от модели устройств и их мощностей. 

Главная область применения таких приложений – мобильные устройства. Пользователю больше не нужно входить на AppStore или PlayMarket, чтобы скачать программу – все сделает браузер автоматически (а еще создаст ярлык на рабочем столе, позволит работать с собой без доступа к сети и т.д.). Фактически, мы получаем аналог обычного приложения с тем же функционалом и множеством плюсов (для PWA не требуется лишняя память смартфона, ради которой приходится удалять фото и видео, они весят менее 1 Мб).

При появлении нового контента PWA отправляет пользователю push-уведомление. Следует признать, что в скором времени эти приложения смогут заменить практически все мобильные аналоги. Хоть технология и появилась в 2007 году в компании Apple, изначально она «не зашла» в силу слабой «прогретости» публики, зато ко второй половине 2016 года Google развил ее и сделал популярной.

<strong> Примеры:</strong>

1. [Aliexpress](https://aliexpress.ru);

2. [Сервисы Google](https://docs.google.com/document/u/0/)(докс, почта);

3. [Сервисы Яндекс](https://yandex.ru/all).

__Основные преимущества и недостатки SPA, MPA и PWA приложений:__
<table>
	<tbody>
		<tr>
			<td>приложение</td>
			<td>преимущества</td>
			<td>недостатки</td>
		</tr>
		<tr>
			<td>SPA</td>
			<td>Высокая скорость работы, кеширование данных и быстрая разработка</td>
			<td>Большая нагрузка на браузер, возможны утечки данных и слабая безопасность.</td>
		</tr>
		<tr>
			<td>MPA</td>
			<td>Более привычны для пользователя, просты в seo-оптимизации.</td>
			<td>Сложная разработка и поддержка, дорого.</td>
		</tr>
		<tr>
			<td>PWA</td>
			<td>Быстрая разработка, возможность офф-лайн работы и хорошая скорость загрузки.</td>
			<td>Поддерживается не всеми браузерами и платформами.</td>
		</tr>
	</tbody>
</table>

## Зачем вообще нужны pwa? почему нельзя ограничиться spa или mpa?
PWA – технология, которая позволяет конвертировать сайты в мобильные приложения, которые будут быстро загружаться на телефонах и планшетах. По интерфейсу Progressive Web Apps практически не отличаются от обычных приложений, но проще последних в разработке и поддержке. PWA — технология, которая сокращает путь привлечения клиентов и сохраняет их вовлеченность. Эту технологию внедряют как большие, так и малые компании.PWA — это веб-приложение, которое может быть установлено на вашу систему. Оно работает оффлайн, когда нет подключения к интернету, по-максимуму используя данные, закэшированные во время вашей последней работы с приложением. Если вы заходите на сайт из Chrome на десктопе, и у вас включены соответствующие флаги, то вас попросят установить приложение. С PWA всё загружается плавно и бесшовно. Это из-за того, что приложение находится на устройстве пользователя, оно способно отправлять push-уведомления и имеет доступ к функциям устройства как нативные приложения.

## почему нельзя ограничиться spa или mpa?
Обе архитектуры имеют свои плюсы и минусы. Хотя SPA предоставляет вам более высокую скорость и повторно используемый код, который вы можете использовать для разработки своего мобильного приложения, ему не хватает SEO-рейтинга; MPA, с другой стороны, обеспечивает вам рейтинг SEO и лучшую масштабируемость, но ему не хватает скорости.

## Какие технологии используются для реализации PWA?
Service Worker

Сердце PWA — Service Worker. Это проксирующий слой между фронтэндом и бэкэндом, находящийся в браузере. Все запросы браузера идут через него. Данное разделение на два независимых слоя позволило сделать переход обычного веб сайта в PWA максимально простым.

Из хранилищ у Service Worker'a есть доступ к Cache Storage для web ресурсов, и IndexDB для данных. Но, самое главное, полная свобода для реализации бизнес логики.

Можно, например, принять запрос от браузера, проверить состояние сети, взять данные из хранилища, произвести с ними операции и вернуть некий результат обратно в браузер — который будет думать, что ответ ему пришел от сервера. Или не будет — как разработчик захочет, так и сделает. Два браузерных слоя (клиентский фронтэнд и Service Worker) позволяют писать полноценные приложения.

В тоже время, для большинства сайтов будет достаточно кэширующей функциональности Service Worker'a, чтобы превратиться в PWA.

PWA не зависит ни от каких-то фреймворков, это чистый javascript, хотя даже специалисты Google на Хабре зачем-то советуют использовать библиотечные генераторы кода. Service Worker прекрасно пишется руками, и это нужно, чтобы хорошо понимать и контролировать логику работы твоего приложения.

С программистской точки зрения Service Worker представляет собой javascript файл, подключаемый в html коде страницы. В нем разработчик определяет логику работы с приходящими из фронтэнда запросами и другую функциональность.

HTTPS

PWA требует, чтобы все ресурсы сайта передавались по HTTPS протоколу. SSL сертификат можно получить бесплатно, некоторые хостеры это делают за вас. Но критично, чтобы на сайте не было ссылок на незащищенные ресурсы — некоторые браузеры просто не будут отображать сайт в этом случае.

Основная встречаемая в таких случаях проблема — картинки. Часто редакторы или комментаторы ставят в материал ссылки на картинки из интернета, иногда они автоматически туда (в материал) попадают. Необходимо картинки пересохранять или к себе, или на сервис с доступом по HTTPS.

Application Shell

App shell — это просто скелет графического интерфейса, шаблон. Для примера, возьмем средний сайт c хидером, двумя колонками и прочим. Грубо говоря, вырежем из него контент текущей страницы и всю динамическую информацию, оставшаяся статика — app shell.

Суть в том, что app shell хранится на клиенте и загружается при запуске приложения, а затем уже в него грузится из сети динамическая информация. И пока она грузится, app shell должен выглядеть красиво («лоадеры» на местах и т.п.)

Данную архитектуру сайта — загрузку контента и иной динамичной информации через ajax вызовы — можно продумать и реализовать на сайте заранее, тогда переход в PWA будет совсем несложным.

App shell — это как оболочка нативной программы. Смотрите на свое PWA как на нативную программу, и многое станет проще.

Web App manifest

JSON файл, декларативно определяющий для браузера название приложения, иконку, как будет выглядеть PWA (fullscreen, standalone и др.) и некоторые другие параметры. Позволяет «установить» PWA как отдельное приложение на домашний экран смартфона.

Push Notifications

Если посерфить интернет с Chrome DevTools, открытым на вкладке Application, то можно увидеть, как мало сайтов пользуют PWA технологии. А 90% тех, что пользуют, делают это только ради Push Notifications.

Пока что это самая популярная и самая злоупотребляемая технология PWA — за последние несколько месяцев число сайтов, заходя на которые первым делом ищешь «мышкой» кнопку «Блокировать» на предложение получать самые свежие новости, выросло, такое ощущение, многократно, а само желание навязать свой Push похоже на Spam.

А ведь можно же предлагать подписку на второй или третий заход пользователя на сайт, когда уже понятно, что он тут не случайно.


## Как можно понять (и можно ли), что перед нами PWA, а не другие виды приложений?
Между PWA и другими видами приложений существуют следующие различия:

1. PWA могут быть установлены на домашний экран, как нативные приложения, но также могут работать в автономном режиме, как нативные приложения. В случае с мобильной версией сайта, ярлык откроется в браузере, а PWA — отдельным приложением.

2. PWA позволяет пользователям взаимодействовать с приложением независимо от интернет-соединения. Это становится возможным из-за заблаговременного кэширования данных приложением. Сайт не может работать без интернета (мобильного или Wi-Fi), в отличие от PWA. 

3. PWA сохраняет важные особенности нативных приложений. Например, есть возможность отправлять пользователям push-уведомления. Многие владельцы интернет-магазинов и других коммерческих площадок инвестируют в приложения, чтобы получить прямой доступ к аудитории.

4. Чтобы соответствовать вышеуказанным особенностям (работать офлайн и присылать уведомления), в структуре всех PWA должны быть предусмотрены такие элементы как Service Worker и манифест. Манифест предоставляет информацию о веб-приложении в текстовом файле JSON (manifest.json). Он нужен для того, чтобы приложение загружалось, оставляло ярлык на главном экране и выглядело для пользователя как обычное приложение. Также от него зависит, какие файлы нужно хранить, а какие заменять новыми в хранилище браузера.
Могут понадобиться и другие технологии. Например, Web Storage – веб-хранилище, где хранятся данные: только во время сеанса (sessionStorage) или между несколькими сессиями (localStorage).

5. Ещё одна особенность PWA — быстрая загрузка контента. В момент запуска нативное приложение может отправлять десятки и даже сотни запросов к удалённому серверу. Скорость обработки данных зависит от большого количества факторов, поэтому заранее предсказать результат не получится.

6. Технология создания PWA требует, чтобы обмен данными велся через протокол HTTPS. Для чего необходимо установить SSL-сертификат, создающий безопасное зашифрованное соединение между внутренним и внешним сервером. Очень важно, чтобы сайт не давал ссылок на незащищенные ресурсы, особенно если речь идет об онлайн магазине, где нужно обеспечить безопасность данных клиентов. Защищенный веб-сайт — это не только хорошая практика, но также и гарантия того, что ваше веб-приложение будет считаться надежным. 

## Чем отличается между собой тестирование SPA и MPA?

Учитывая особенности обоих видов приложений, их достоинства и недостатки (см.выше)
Можно сделать вывод о том, что различия тестирования mpa и spa будут в следующем:

* __Тестирование производительности.__ Поскольку в MPA для каждого нового запроса, который делает пользователь, сервер отображает новую веб-страницу, это увеличивает время загрузки и отрицательно влияет на производительность приложения, что требует большего внимания.

* __Нагрузочное тестирование.__ Проверка того, как сервис работает при экстремальных нагрузках, длительном использовании и разных объёмах хранимых и обрабатываемых данных будет отличаться, так как В отличие от SPA, которые требуют загрузки тяжелых клиентских фреймворков на клиентский компьютер для повышения эффективности, MPA не требуют никаких таких фреймворков, что делает начальную скорость загрузки страницы выше, чем у SPA. Но, в то же время Одностраничные приложения получают всю необходимую разметку, необходимую для загрузки страницы, только один раз с веб-серверов. Когда пользователь взаимодействует со страницей, загружаются только определенные элементы данных. Это сокращает время загрузки веб-страниц и обеспечивает плавную навигацию пользователя по веб-странице.

* __Тестирование навигации__ mpa более требовательное, так как в них можно использовать кнопки «назад» и «вперед» в браузере. Кроме того, многостраничные приложения также поставляются с картой сайта, что упрощает навигацию для посетителей. А в spa кнопки "вперед" и "назад" браузеров не работают. 


 ## Как тестировать PWA?
При тестировании прогрессивного веб-приложения необходимо проверить следующие моменты:
1.	__Сайт обслуживается по HTTPS:__ Безопасность является одной из основных проблем в прогрессивном веб-приложении, поэтому необходимо убедиться, что веб-приложение обслуживается по HTTPS.
Как проверить? Можно использовать Lighthouse от Google Developers, jitbit, seositecheckup, digicert, ssl shopper, ssl labs и т.д., чтобы проверить, обслуживается ли ваш сайт по HTTPS или нет.
2.	__Веб-страницы отзывчивы:__ веб-приложение демонстрирует отзывчивое поведение на всех мобильных и настольных устройствах.
Как проверить? Вы можно использовать функцию отзывчивости LambdaTest для проверки отзывчивости веб-приложения.
3.	__Автономная загрузка:__ Все веб-страницы или хотя бы некоторые из них должны работать, даже когда приложение находится в автономном режиме. Как проверить? Опять же, поскольку Google активно продвигает экосистему PWA, у них есть одни из лучших инструментов для тестирования PWA-приложений. Например, Lighthouse. Альтернативой является Wiremock.
4.	__Кросс-браузерная совместимость:__ Необходимо протестировать веб-приложение на кросс-браузерную совместимость, чтобы убедиться, что веб-приложение обеспечивает удобство работы во всех браузерах.
Как протестировать? Вы можете использовать LambdaTest для тестирования кросс-браузерной совместимости.
5.	__Переходы между страницами должны быть плавными__ и не должны вызывать ощущения, что они блокируют сеть: Переходы являются ключевым фактором для восприятия производительности, поэтому они не должны быть плавными при перемещении, даже при медленном интернет-соединении.
Как проверить? Это следует делать вручную в медленной сети. При нажатии на любую кнопку или ссылку, она должна немедленно реагировать либо немедленным переходом на экран гнезда и в ожидании показывать экран загрузки, либо индикатором загрузки, пока приложение не дождется ответа.
6.	__Каждая страница должна иметь URL:__ Каждая страница веб-приложения должна иметь URL, и все URL должны быть уникальными.
Как проверить? Проверьте, что на каждую страницу можно перейти по URL, и он должен быть уникальным, чтобы им можно было поделиться в социальных сетях или на других платформах. URL также можно открывать непосредственно в новых браузерах.
7.	__Возможность совместного использования:__ Контентом должно быть легко поделиться даже в полноэкранном режиме, и он должен формировать карточки для всех платформ социальных сетей.
Как протестировать? Протестировать вручную, поделившись контентом в полноэкранном режиме. 
8. __Push-уведомления:__ Если push-уведомления применимы для веб-приложения, они не должны быть слишком агрессивными.
Как протестировать? Протестировать поток отказа от push-уведомлений. Должна быть четкая инструкция, указывающая, для чего сайт хочет получить разрешение и почему пользователь должен включить push-уведомления.
