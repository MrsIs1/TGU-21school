# Уровни и типы логов

**Лог (log)** - это хронологическая запись наиболее значимой информации о работе системы. Подобная фиксация событий дает представление и том, что происходило в системе, в какой именно момент, какой пользователь спровоцировал то или иное событие, какие ошибки возникли и т.д.

Запись оформляется в особый файл, который еще называют лог-файлом или журналом логов. Для специалиста такой файл — это книга или справочник, рассказывающий о том, что происходило в системе в конкретный период времени. Грамотные администраторы, обращаясь к подобным записям, могут не только выявить проблему в работе системы на ранней стадии, но и вовремя предотвратить сбой в ее работе. Несанкционированные действия или установление вредоносных программ также фиксируются журналами логов. И по ним можно достаточно эффективно выявить внешнее вмешательство в работу сайта. Таким образом логи используются для контроля, мониторинга, анализа, защиты и оптимизации работы приложений и серверов.

## Какие существуют типы и уровни логов?

**Уровни логирования**

В идеале логи пишутся во время работы всех IT-систем, однако если писать все подряд и «складывать в кучу», полезная информация превратится в хаос. Чтобы упростить поиск и чтение логов, их делят на уровни. Основных четыре:

1. Debug — запись масштабных переходов состояний, например, обращение к базе данных, старт/пауза сервиса, успешная обработка записи и пр.

2. Warning — нештатная ситуация, потенциальная проблема, может быть странный формат запроса или некорректный параметр вызова.

3. Error — типичная ошибка.

4. Fatal — тотальный сбой работоспособности, когда нет доступа к базе данных или сети, сервису не хватает места на жестком диске.

Дополнительно файл логирования может расширяться записями еще двух уровней:

5. Trace  — пошаговые записи процесса. Полезен, когда сложно локализовать ошибку.

6. Info — общая информация о работе службы или сервиса.

Работа с уровнями  регламентируется методическими документами и внутренними правилами организации. В них может определяться соответствие источника логирования сообщения уровню логирования, значимость, порядок обработки каждого уровня и другие параметры.

**Типы логов**

Для удобства обработки логов их делят на типы:

1. системные, связанные с системными событиями,

2. серверные, отвечающие за процесс обращения к серверу,

3. почтовые, работающие с отправлениями,

4. логи баз данных, которые отражают процессы обращения к базам данных,

5. авторизационные и аутентификационные, которые отвечают за процесс входа, выхода из системы, восстановление доступа и пр.

У каждого типа логов свой журнал записи. Для проверки логов авторизации нужно идти в журнал доступов, чтобы проверить загрузку системы — в журнал dmesg, за данными о запросах пользователей — в access_log. Когда одни логи пишутся отдельно от других, проще диагностировать ситуацию и найти источник проблемы.


## Какое расширение имеет файл с логами?

**Какими бывают логи**
Информации в логах много, поэтому для каждого типа сведений существует свой лог-файл. Возьмем для примера логи веб-сервера. Вот какими они могут быть:

- основной рассказывает о главных событиях, которые произошли непосредственно с серверным ПО;

- журнал доступа содержит сведения о посетителях сайта;

- лог ошибок сообщает обо всех сбоях, которые произошли во время работы ПО;

- лог веб-сервера рассказывает об обращениях к серверу и о возможных ошибках;

- лог баз данных записывает сведения о действиях с БД, запросах и ошибках;

- лог почтового сервера содержит информацию об отправленных и полученных письмах и так далее.


Наиболее важными считаются логи сервера, доступа и ошибок, но проверять советуют не только их. Мы перечислили только несколько примеров: отдельные журналы могут быть у планировщика задач, клиента передачи файлов, хостинга и многих других подсистем. Информация по каждой из них пишется в свой лог.

В лог-файлах находится полный журнал событий, связанных с конкретным узлом. Там описываются время события, тип запроса, реакция сервера, код ответа, IP-адрес пользователя, количество переданной информации и многое другое. Если произошла ошибка, это будет помечено в логах отдельно.

Но вся перечисленная информация представлена в очень сжатом виде. Поэтому незнакомый с правилами записи человек может в ней запутаться. Более того, в логах много сведений, поэтому они очень подробные и обширные. Бывает сложно отделить нужную информацию от той, которая не пригодится сейчас.

**Как правильно читать лог**

Вручную. **Логи хранятся в файлах с расширением .log**. Их можно открыть как обычные текстовые файлы и просмотреть содержимое. Перед этим стоит посмотреть, как настроен формат записи логов, если у вас есть доступ к этим параметрам.

Например, так выглядит формат по умолчанию для лога доступа с веб-сервера:

[доменное имя сайта][IP-адрес пользователя][дата и время визита][тип запроса][URL, к которому обратился пользователь][протокол, по которому пользователь соединился с сайтом][код ответа сервера][количество байт информации, которую передали пользователю][дополнительная информация]

Данные чаще всего разделяются пробелами, иногда также дефисами или слэшами. Каждая запись показывается с новой строчки. Читать полные логи в таком формате довольно трудоемко, поэтому главное — найти нужные строки и сконцентрироваться на них.

Это не единственный возможный способ записи лога. Например, в логе ошибок каждая строчка — это запись об ошибке с полной информацией о ней: датой и временем, адресом страницы, на которой возник сбой, и так далее.

С помощью анализатора. Второй вариант — не просматривать лог вручную, а воспользоваться специальной программой-анализатором. Она парсит лог-файл — «разбирает» его на составляющие и представляет в удобном для пользователя виде. Так информация показывается в виде понятного отчета, иногда с графиками и диаграммами.

Анализаторы бывают разными, например Weblog Expert, Analog и пр. Некоторые из них также умеют интегрироваться с сервисами для сбора статистики, чтобы показывать более полную картинку.

Проверять и читать логи вам понадобится, если вы будете работать с профессиональным ПО для разработчиков, вебмастеров или инженеров. Это сложно только с первого взгляда — если понять принцип, расшифровать их не составит труда. А анализаторы помогут лучше и быстрее сориентироваться в записях.

## Какие программы используются для просмотра логов?

Для сбора и чтения лог-файлов используют программы-анализаторы. Они позволяют читать логи сервера без значительных временных затрат. 
Подборка программных средств, которые предназначены для мониторинга, логирования и сбора показателей:

#### Мониторинг:
• Alerta — масштабируемая, гибкая и распределённая система мониторинга;

• Adagios — web-интерфейс для конфигурации Nagios;

• Cacti — инструмент с web-интерфейсом, собирающий статистические данные за временные интервалы и позволяющий отобразить их в графическом виде;

• Cabot — служба мониторинга и оповещений на собственном сервере;

• Centreon — опенсорсный инструмент для мониторинга производительности;

• check_mk — комплект расширений для Nagios;

• Dash — web-дашборд для Linux;

• Flapjack — система мониторинга маршрутизации уведомлений;

• Monit — для управления и мониторинга Unix-систем;

• Munin — сетевой инструмент, обеспечивающий мониторинг ресурсов;

• Naemon — сетевой инструмент, обеспечивающий мониторинг. Основан на Nagios, но имеет улучшенную производительность и обновлённую функциональность;

• Nagios — известный опенсорсный инструмент для мониторинга компьютерных сетей и систем. Используется для наблюдения и контроля состояния вычислительных служб и узлов, а также оповещения сисадмина, если какие-нибудь службы прекращают работу;

• Observium — система мониторинга для Cisco, Linux, HP, Juniper, Windows, Dell, Brocade, Netscaler, FreeBSD, NetApp и прочих. Имеет платную и бесплатную версии;

• OMD — система для сетевого мониторинга;

• Opsview — эта система мониторинга основана на Nagios 4;

• Riemann — гибкий инструмент мониторинга распределённых систем;

• Sensu — опенсорсный фреймворк для мониторинга на Ruby;

• Sentry — для мониторинга приложений и логирования событий;

• Serverstats – простой инструмент создания графиков посредством rrdtool;

• Seyren — дашборд с оповещениями для Graphite;

• Shinken — опенсорсный фреймворк для мониторинга на «Пайтон»;

• Thruk — web-интерфейс для Nagios, Icinga, Naemon, Shinken;

• Zabbix — известнейшая опенсорсная система мониторинга и отслеживания статусов различных сервисов компьютерной сети, а также серверов и сетевого оборудования.

#### Сбор показателей:
• Collectd — демон для сбора системной статистики;

• Collectl — очень точный инструмент, обеспечивающий сбор показателей производительности системы;

• Smashing — фреймворк на Ruby, с помощью которого можно создавать дашборды. Форк Dashing;

• Diamond — демон на Python, обеспечивающий сбор статистики;

• Facette — для визуализации временных данных. Написан на Go; • Freeboard — для создания дашбордов;

• Ganglia — распределённая масштабируемая система мониторинга, предназначенная для высокопроизводительных систем;

• Grafana — популярное ПО для анализа временных рядов;

• Graphite — для хранения и отображения временных данных;

• InfluxDB — опенсорсная распределённая БД для хранения временных рядов;

• KairosDB — БД для хранения временных рядов, форк OpenTSDB 1.x;

• NetData — система, обеспечивающая распределённый мониторинг производительности и работоспособности в режиме реального времени;

• OpenTSDB — распределённая и масштабируемая опенсорсная БД для хранения временных рядов;

• Packetbeat — захватывает сетевой трафик и отображает его на дашборде Kibana;

• Prometheus — система мониторинга сервисов и БД временных рядов;

• RRDtool — комплект программных средств, обеспечивающих хранение, обработку и визуализацию динамических последовательностей данных;

• Statsd — демон на Node.js, который служит для сбора статистики.

#### Работа с логами:
• Echofish — система сбора и анализа логов в режиме реального времени;

• Fluentd — опенсорсная система по сбору логов;

• Flume — распределённая система, предназначенная для сбора и агрегации логов;

• Graylog2 — сервер, обеспечивающий анализ событий и логов с возможностью оповещения;

• Heka — система, предназначенная для работы с логами от Mozilla;

• Kibana — инструмент визуализации данных;

• Logstash — инструмент управления событиями и логами;

• Octopussy — опенсорсное решение для работы с логами.

#### Список анализаторов логов:

1. **Loggly** одно из самых популярных решений для управления логами, подходит для анализа данных практически из любого источника, включая следующие:
* веб-приложения — Apache, Nginx, PHP, Node.js, .NET, Java, JavaScript
* операционные системы – Linux, Windows
С помощью Loggly вы можете собирать данные (логи) для анализа и создавать содержательные информационные панели для мониторинга необходимых показателей. Разумеется, вы можете осуществлять поиск в логах из интерфейса Loggly.   
Loggly обладает мощной поисковой системой, в которой вы можете настраивать и устанавливать фильтры для всего текста, одного поля и булевских значений. Вы можете также привязать электронную почту, PageDuty, Slack, HipChat и т.д., чтобы получать оповещения.

2. **SumoLogic**
Получите информационную аналитику в режиме реального времени с помощью SumoLogic для мониторинга, анализа, устранения проблем и защиты бизнес приложений и инфраструктуры.   
У SumoLogic есть агент-сборщик/облачный сборщик, который необходимо установить на ваш сервер для передачи логов в SumoLogic. Вы можете преобразовывать любые типы логов составляя наглядную картину происходящего, обновляющуюся в реальном времени, для мониторинга и оповещения о достижении заданных границ.  
SumoLogic имеет несколько заранее настроенных приложений, основанных на наиболее распространенных способах применения для ускорения работающих задач и изучения проблем.

3. **Splunk Cloud** доступен  для сбора и индексирования любого типа информации. Splunk — это быстрый и простой способ анализа и визуализации данных, создаваемых на физических, облачных или виртуальных устройствах.
С помощью Splunk вы можете отслеживать и визуализировать данные и настраивать пороговые показатели для оповещений. 

4. **Papertrail** может собирать данные из syslog, text, Apache, MySQL, приложений Heroku, журнала событий Windows, маршрутизаторов, брандмауэров, RubyOnRails и многого другого.
Вы можете выполнять поиск в режиме реального времени с помощью браузера, командной строки или API и получать оповещения по электронной почте или Slack.

5. **Logz.io** предоставляет размещение ELK как услугу. ELK (Elastic Search, Logstash, Kibana) — одна из самых популярных платформ для анализа с открытым исходным кодом. Если вы ищете гибкую платформу для обработки логов, то Logz.io будет вам полезен.
Logz.io может индексировать данные почти всех современных технологий и предоставлять вам подробный анализ с визуализацией данных и оповещениями.

6. **Timber**
Отслеживание в режиме реального времени, современная система фильтрации, быстрый поиск, а также возможность интеграции Timber с вашим приложением или платформой.

7. **Logentries**
Отправьте любые данные в Logentries для немедленного поиска и визуализации данных. Вы можете следить за логами в пользовательском интерфейсе Logentries и немедленно получать оповещения о необходимых значениях.
Оповещения могут быть переданы в Slack, Hipchat, Pagerduty или при помощи вебхуков. Logentries предоставляет REST API для запроса ваших логов для визуализации.

8. **Logsene**
Logsene от Sematext — это ваш облачный управляемый ELK Stack для управления и анализа логов. Вы можете отправлять логи через зашифрованные каналы из любого источника, включая Syslog.Он работает на AWS и поддерживает SOC, SSAE, FISMA, DIACAP, HIPPA и др.
